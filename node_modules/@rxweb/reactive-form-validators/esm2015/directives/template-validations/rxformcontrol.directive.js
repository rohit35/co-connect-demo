import * as tslib_1 from "tslib";
import { Directive, Input, ElementRef, forwardRef, OnInit, OnDestroy, Renderer2 } from '@angular/core';
import { NG_VALIDATORS } from '@angular/forms';
import { APP_VALIDATORS } from '../../const/app-validators.const';
import { BaseValidator } from './base-validator.directive';
import { ELEMENT_VALUE, BLUR, FOCUS, BLANK } from "../../const";
import { TEMPLATE_VALIDATION_CONFIG, CONDITIONAL_VALIDATOR, VALIDATOR_CONFIG } from '../../const/app.const';
import { ApplicationUtil } from '../../util/app-util';
import { DecimalProvider } from "../../domain/element-processor/decimal.provider";
import { RegexValidator } from '../../util';
import { MaskProvider } from '../../domain/element-processor/mask.provider';
const NGMODEL_BINDING = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(() => RxFormControlDirective),
    multi: true
};
const ALLOW_VALIDATOR_WITHOUT_CONFIG = ['required', 'notEmpty', 'alpha', 'alphaNumeric', 'ascii', 'dataUri', 'digit', 'email', 'even', 'hexColor', 'json', 'latitude', 'latLong', 'leapYear', 'longitude', 'lowerCase', 'mac', 'odd', 'port', 'primeNumber', 'time', 'upperCase', 'url', 'unique', 'cusip', 'gird'];
const NUMERIC = "numeric";
const IS_FORMAT = "isFormat";
const DIGITS_INFO = "digitsInfo";
let RxFormControlDirective = class RxFormControlDirective extends BaseValidator {
    constructor(elementRef, renderer, decimalProvider) {
        super();
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.decimalProvider = decimalProvider;
        this.eventListeners = [];
        this.isNumericSubscribed = false;
        this.isFocusCalled = false;
        this.isMasked = false;
        this.element = elementRef.nativeElement;
        this.setEventName();
    }
    set validationControls(value) {
        this.controls = value;
    }
    get validationControls() {
        return this.controls;
    }
    ngOnInit() {
        let validators = [];
        Object.keys(APP_VALIDATORS).forEach(validatorName => {
            if ((this[validatorName]) || (ALLOW_VALIDATOR_WITHOUT_CONFIG.indexOf(validatorName) != -1 && this[validatorName] == BLANK)) {
                validators.push(APP_VALIDATORS[validatorName](this[validatorName]));
                if (this.name && !(this.formControlName && this.formControl)) {
                    ApplicationUtil.configureControl(this.controlConfig, this[validatorName], validatorName);
                }
            }
        });
        if (validators.length > 0)
            this.validators = validators;
        if (this.numeric && (this.numeric.isFormat || this.numeric.digitsInfo)) {
            this.bindNumericElementEvent();
        }
    }
    blurEvent() {
        if (!(this.formControl && this.formControl.errors && this.formControl.errors.numeric)) {
            let value = this.decimalProvider.transFormDecimal(this.formControl.value, this.numeric.digitsInfo);
            value = (!this.numeric.isFormat) ? this.decimalProvider.replacer(value) : value;
            this.setValueOnElement(value);
            this.isFocusCalled = false;
        }
    }
    bindNumericElementEvent(config) {
        if (config)
            this.numeric = config;
        let listener = this.renderer.listen(this.element, BLUR, this.blurEvent.bind(this));
        this.eventListeners.push(listener);
        listener = this.renderer.listen(this.element, FOCUS, (event) => {
            this.isFocusCalled = true;
            if (!(this.formControl && this.formControl.errors && this.formControl.errors.numeric) && this.formControl.value != null) {
                let value = this.decimalProvider.replacer(this.element.value);
                this.setValueOnElement(value);
            }
        });
        this.eventListeners.push(listener);
    }
    bindValueChangeEvent() {
        if (this.eventName != BLANK) {
            let listener = this.renderer.listen(this.element, this.eventName, () => {
                Object.keys(this.validationControls).forEach(fieldName => {
                    this.validationControls[fieldName].updateValueAndValidity();
                });
            });
            this.eventListeners.push(listener);
        }
    }
    subscribeNumericFormatter() {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG][NUMERIC] && (this.formControl[VALIDATOR_CONFIG][NUMERIC][IS_FORMAT] || this.formControl[VALIDATOR_CONFIG][NUMERIC][DIGITS_INFO])) {
            if (!this.isNumericSubscribed) {
                this.bindNumericElementEvent(this.formControl[VALIDATOR_CONFIG][NUMERIC]);
                this.isNumericSubscribed = true;
            }
            if (!this.isFocusCalled && RegexValidator.isNotBlank(this.formControl.value)) {
                this.blurEvent();
            }
        }
    }
    subscribeMaskValidator() {
        if (this.formControl[VALIDATOR_CONFIG] && this.formControl[VALIDATOR_CONFIG]["mask"] && !this.isMasked) {
            let config = this.formControl[VALIDATOR_CONFIG]["mask"];
            this.maskProvider = new MaskProvider(this.element, config.mask, this.renderer, this.formControl, config);
            this.isMasked = true;
        }
    }
    setValueOnElement(value) {
        this.renderer.setProperty(this.element, ELEMENT_VALUE, value);
    }
    setTemplateValidators(control) {
        for (let validatorName in control[VALIDATOR_CONFIG]) {
            this[validatorName] = control[VALIDATOR_CONFIG][validatorName];
        }
        delete control[TEMPLATE_VALIDATION_CONFIG];
        delete control[VALIDATOR_CONFIG];
        this.ngOnInit();
    }
    updateOnElementClass(element) {
        var previousClassName = '';
        return function (className) {
            if (previousClassName)
                element.classList.remove(previousClassName);
            if (className)
                element.classList.add(className);
            previousClassName = className;
        };
    }
    setValidatorConfig(control) {
        if (!this.formControl) {
            this.formControl = control;
            let rxFormControl = this.formControl;
            if (rxFormControl.updateOnElementClass)
                rxFormControl.updateOnElementClass = this.updateOnElementClass(this.element);
        }
        this.subscribeMaskValidator();
        this.subscribeNumericFormatter();
        if (control[TEMPLATE_VALIDATION_CONFIG])
            this.setTemplateValidators(control);
        if (control[CONDITIONAL_VALIDATOR]) {
            this.conditionalValidator = control[CONDITIONAL_VALIDATOR];
            delete control[CONDITIONAL_VALIDATOR];
        }
    }
    validate(control) {
        this.setValidatorConfig(control);
        if (this.conditionalValidator)
            this.conditionalValidator(control);
        if (!this.isProcessed)
            this.setModelConfig(control);
        return ((this.validators && this.validators.length > 0) || this.maskProvider) ? this.validation(control) : null;
    }
    ngOnDestroy() {
        this.controls = undefined;
        let eventCount = this.eventListeners.length;
        for (var i = 0; i < eventCount; i++) {
            this.eventListeners[0]();
            this.eventListeners.splice(0, 1);
        }
        this.eventListeners = [];
        if (this.maskProvider)
            this.maskProvider.onDestroy();
    }
};
RxFormControlDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DecimalProvider }
];
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "alpha", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "alphaNumeric", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "ascii", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "compare", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "compose", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "contains", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "creditCard", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "dataUri", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "different", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "digit", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "email", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "endsWith", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "even", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "extension", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "factor", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "fileSize", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "greaterThanEqualTo", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "greaterThan", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "hexColor", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "json", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "latitude", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "latLong", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "leapYear", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "lessThan", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "lessThanEqualTo", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "longitude", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "lowerCase", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "mac", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "maxDate", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "maxLength", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "maxNumber", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "minDate", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "minLength", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "minNumber", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "numeric", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "odd", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "password", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "port", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "primeNumber", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "required", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "range", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "rule", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "startsWith", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "time", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "upperCase", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "url", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "unique", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "notEmpty", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "cusip", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "grid", void 0);
tslib_1.__decorate([
    Input()
], RxFormControlDirective.prototype, "date", void 0);
RxFormControlDirective = tslib_1.__decorate([
    Directive({
        selector: '[ngModel],[formControlName],[formControl]',
        providers: [NGMODEL_BINDING],
    })
], RxFormControlDirective);
export { RxFormControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnhmb3JtY29udHJvbC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Acnh3ZWIvcmVhY3RpdmUtZm9ybS12YWxpZGF0b3JzLyIsInNvdXJjZXMiOlsiZGlyZWN0aXZlcy90ZW1wbGF0ZS12YWxpZGF0aW9ucy9yeGZvcm1jb250cm9sLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQWEsYUFBYSxFQUFnQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNsRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUNGLGFBQWEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFDckMsTUFBTSxhQUFhLENBQUM7QUFDckIsT0FBTyxFQUFFLDBCQUEwQixFQUFDLHFCQUFxQixFQUFDLGdCQUFnQixFQUFHLE1BQU0sdUJBQXVCLENBQUE7QUFDMUcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxpREFBaUQsQ0FBQTtBQUVqRixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRTVDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUc1RSxNQUFNLGVBQWUsR0FBUTtJQUN6QixPQUFPLEVBQUUsYUFBYTtJQUN0QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHNCQUFzQixDQUFDO0lBQ3JELEtBQUssRUFBRSxJQUFJO0NBQ2QsQ0FBQztBQUVGLE1BQU0sOEJBQThCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBQyxPQUFPLEVBQUMsTUFBTSxDQUFDLENBQUM7QUFDbFQsTUFBTSxPQUFPLEdBQVUsU0FBUyxDQUFDO0FBQ2pDLE1BQU0sU0FBUyxHQUFVLFVBQVUsQ0FBQztBQUNwQyxNQUFNLFdBQVcsR0FBVyxZQUFZLENBQUM7QUFLekMsSUFBYSxzQkFBc0IsR0FBbkMsTUFBYSxzQkFBdUIsU0FBUSxhQUFhO0lBcUVyRCxZQUFvQixVQUFzQixFQUM5QixRQUFtQixFQUFVLGVBQWdDO1FBQ3JFLEtBQUssRUFBRSxDQUFDO1FBRlEsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUM5QixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQVUsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBckVqRSxtQkFBYyxHQUFVLEVBQUUsQ0FBQztRQUMzQix3QkFBbUIsR0FBWSxLQUFLLENBQUM7UUFDckMsa0JBQWEsR0FBWSxLQUFLLENBQUM7UUFDL0IsYUFBUSxHQUFZLEtBQUssQ0FBQztRQW9FOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBcUIsQ0FBQztRQUNoRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQW5FRCxJQUFJLGtCQUFrQixDQUFDLEtBQXFDO1FBQ3hELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQzFCLENBQUM7SUFFRCxJQUFJLGtCQUFrQjtRQUNsQixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDekIsQ0FBQztJQStERCxRQUFRO1FBQ0osSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUFFO1lBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUU7Z0JBQ3hILFVBQVUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BFLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7b0JBQzFELGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQztpQkFDNUY7YUFFSjtRQUNMLENBQUMsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUM7WUFDckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUE7UUFDaEMsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUNwRSxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztTQUNsQztJQUVMLENBQUM7SUFHRCxTQUFTO1FBQ0wsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNuRixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbkcsS0FBSyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ2hGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztTQUM5QjtJQUNMLENBQUM7SUFFRCx1QkFBdUIsQ0FBQyxNQUFzQjtRQUMxQyxJQUFJLE1BQU07WUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUMxQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQzNELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1lBQzFCLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLElBQUksSUFBSSxFQUFFO2dCQUNySCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM5RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDakM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3RDLENBQUM7SUFFRCxvQkFBb0I7UUFDaEIsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssRUFBRTtZQUN6QixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO2dCQUNuRSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDckQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLHNCQUFzQixFQUFFLENBQUM7Z0JBQ2hFLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUN0QztJQUNMLENBQUM7SUFFRCx5QkFBeUI7UUFDckIsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFO1lBQzNNLElBQUcsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUM7Z0JBQ3pCLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDMUUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQzthQUNuQztZQUNELElBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsRUFBQztnQkFDeEUsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2FBQ3BCO1NBQ0o7SUFFTCxDQUFDO0lBRUQsc0JBQXNCO1FBQ2xCLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDcEcsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFdBQTBCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEgsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7U0FDeEI7SUFDTCxDQUFDO0lBRU8saUJBQWlCLENBQUMsS0FBVTtRQUNoQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBRU8scUJBQXFCLENBQUMsT0FBdUI7UUFDakQsS0FBSSxJQUFJLGFBQWEsSUFBSSxPQUFPLENBQUMsZ0JBQWdCLENBQUMsRUFDbEQ7WUFDSSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsYUFBYSxDQUFDLENBQUM7U0FDbEU7UUFDRCxPQUFPLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUE7UUFDaEMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFTyxvQkFBb0IsQ0FBQyxPQUFvQjtRQUM3QyxJQUFJLGlCQUFpQixHQUFXLEVBQUUsQ0FBQztRQUNuQyxPQUFPLFVBQVUsU0FBaUI7WUFDOUIsSUFBSSxpQkFBaUI7Z0JBQ2pCLE9BQU8sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDaEQsSUFBSSxTQUFTO2dCQUNULE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1lBQ3BDLGlCQUFpQixHQUFHLFNBQVMsQ0FBQztRQUNsQyxDQUFDLENBQUE7SUFDTCxDQUFDO0lBRU8sa0JBQWtCLENBQUMsT0FBdUI7UUFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7WUFDM0IsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQTRCLENBQUM7WUFDdEQsSUFBSSxhQUFhLENBQUMsb0JBQW9CO2dCQUNsQyxhQUFhLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNwRjtRQUVELElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1FBQ3JDLElBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDO1lBQ2xDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QyxJQUFJLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUMzRCxPQUFPLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1NBQ3pDO0lBRUQsQ0FBQztJQUVELFFBQVEsQ0FBQyxPQUF3QjtRQUM3QixJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDakMsSUFBSSxJQUFJLENBQUMsb0JBQW9CO1lBQ3pCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVc7WUFDakIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNqQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ3BILENBQUM7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUM7UUFDMUIsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUM7UUFDNUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDekIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDekIsSUFBSSxJQUFJLENBQUMsWUFBWTtZQUNqQixJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3RDLENBQUM7Q0FDSixDQUFBOztZQW5KbUMsVUFBVTtZQUNwQixTQUFTO1lBQTJCLGVBQWU7O0FBdkRoRTtJQUFSLEtBQUssRUFBRTtxREFBb0I7QUFDbkI7SUFBUixLQUFLLEVBQUU7NERBQTJCO0FBQzFCO0lBQVIsS0FBSyxFQUFFO3FEQUFtQjtBQUNsQjtJQUFSLEtBQUssRUFBRTt1REFBd0I7QUFDdkI7SUFBUixLQUFLLEVBQUU7dURBQXdCO0FBQ3ZCO0lBQVIsS0FBSyxFQUFFO3dEQUEwQjtBQUN6QjtJQUFSLEtBQUssRUFBRTswREFBOEI7QUFDN0I7SUFBUixLQUFLLEVBQUU7dURBQXFCO0FBQ3BCO0lBQVIsS0FBSyxFQUFFO3lEQUE0QjtBQUMzQjtJQUFSLEtBQUssRUFBRTtxREFBb0I7QUFDbkI7SUFBUixLQUFLLEVBQUU7cURBQW9CO0FBQ25CO0lBQVIsS0FBSyxFQUFFO3dEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTtvREFBa0I7QUFDakI7SUFBUixLQUFLLEVBQUU7eURBQTRCO0FBQzNCO0lBQVIsS0FBSyxFQUFFO3NEQUFzQjtBQUNyQjtJQUFSLEtBQUssRUFBRTt3REFBc0I7QUFDckI7SUFBUixLQUFLLEVBQUU7a0VBQThDO0FBQzdDO0lBQVIsS0FBSyxFQUFFOzJEQUF1QztBQUN0QztJQUFSLEtBQUssRUFBRTt3REFBeUI7QUFDeEI7SUFBUixLQUFLLEVBQUU7b0RBQXFCO0FBQ3BCO0lBQVIsS0FBSyxFQUFFO3dEQUFzQjtBQUNyQjtJQUFSLEtBQUssRUFBRTt1REFBcUI7QUFDcEI7SUFBUixLQUFLLEVBQUU7d0RBQXNCO0FBQ3JCO0lBQVIsS0FBSyxFQUFFO3dEQUFvQztBQUNuQztJQUFSLEtBQUssRUFBRTsrREFBMkM7QUFDMUM7SUFBUixLQUFLLEVBQUU7eURBQXVCO0FBQ3RCO0lBQVIsS0FBSyxFQUFFO3lEQUEwQjtBQUN6QjtJQUFSLEtBQUssRUFBRTttREFBaUI7QUFDaEI7SUFBUixLQUFLLEVBQUU7dURBQXFCO0FBQ3BCO0lBQVIsS0FBSyxFQUFFO3lEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTt5REFBeUI7QUFDeEI7SUFBUixLQUFLLEVBQUU7dURBQXFCO0FBQ3BCO0lBQVIsS0FBSyxFQUFFO3lEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTt5REFBeUI7QUFDeEI7SUFBUixLQUFLLEVBQUU7dURBQXdCO0FBQ3ZCO0lBQVIsS0FBSyxFQUFFO21EQUFpQjtBQUNoQjtJQUFSLEtBQUssRUFBRTt3REFBMEI7QUFDekI7SUFBUixLQUFLLEVBQUU7b0RBQWtCO0FBQ2pCO0lBQVIsS0FBSyxFQUFFOzJEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTt3REFBMEI7QUFDekI7SUFBUixLQUFLLEVBQUU7cURBQW9CO0FBQ25CO0lBQVIsS0FBSyxFQUFFO29EQUFrQjtBQUNqQjtJQUFSLEtBQUssRUFBRTswREFBMkI7QUFDMUI7SUFBUixLQUFLLEVBQUU7b0RBQWtCO0FBQ2pCO0lBQVIsS0FBSyxFQUFFO3lEQUEwQjtBQUN6QjtJQUFSLEtBQUssRUFBRTttREFBb0I7QUFDbkI7SUFBUixLQUFLLEVBQUU7c0RBQXNCO0FBQ3JCO0lBQVIsS0FBSyxFQUFFO3dEQUFzQjtBQUNyQjtJQUFSLEtBQUssRUFBRTtxREFBbUI7QUFDbEI7SUFBUixLQUFLLEVBQUU7b0RBQWtCO0FBQ2pCO0lBQVIsS0FBSyxFQUFFO29EQUFpQjtBQWpFaEIsc0JBQXNCO0lBSmxDLFNBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSwyQ0FBMkM7UUFDckQsU0FBUyxFQUFFLENBQUMsZUFBZSxDQUFDO0tBQy9CLENBQUM7R0FDVyxzQkFBc0IsQ0F3TmxDO1NBeE5ZLHNCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIE9uSW5pdCwgT25EZXN0cm95LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVmFsaWRhdG9yLCBOR19WQUxJREFUT1JTLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBBUFBfVkFMSURBVE9SUyB9IGZyb20gJy4uLy4uL2NvbnN0L2FwcC12YWxpZGF0b3JzLmNvbnN0JztcclxuaW1wb3J0IHsgQmFzZVZhbGlkYXRvciB9IGZyb20gJy4vYmFzZS12YWxpZGF0b3IuZGlyZWN0aXZlJztcclxuaW1wb3J0IHtcclxuICAgICBFTEVNRU5UX1ZBTFVFLCBCTFVSLCBGT0NVUywgQkxBTktcclxufSBmcm9tIFwiLi4vLi4vY29uc3RcIjtcclxuaW1wb3J0IHsgVEVNUExBVEVfVkFMSURBVElPTl9DT05GSUcsQ09ORElUSU9OQUxfVkFMSURBVE9SLFZBTElEQVRPUl9DT05GSUcgIH0gZnJvbSAnLi4vLi4vY29uc3QvYXBwLmNvbnN0J1xyXG5pbXBvcnQgeyBBcHBsaWNhdGlvblV0aWwgfSBmcm9tICcuLi8uLi91dGlsL2FwcC11dGlsJztcclxuaW1wb3J0IHsgRGVjaW1hbFByb3ZpZGVyIH0gZnJvbSBcIi4uLy4uL2RvbWFpbi9lbGVtZW50LXByb2Nlc3Nvci9kZWNpbWFsLnByb3ZpZGVyXCJcclxuaW1wb3J0IHsgQWxwaGFDb25maWcsIEFycmF5Q29uZmlnLCBCYXNlQ29uZmlnLCBDaG9pY2VDb25maWcsIENvbXBhcmVDb25maWcsIENvbXBvc2VDb25maWcsIENvbnRhaW5zQ29uZmlnLCBDcmVkaXRDYXJkQ29uZmlnLCBEYXRlQ29uZmlnLCBEZWZhdWx0Q29uZmlnLCBEaWdpdENvbmZpZywgRW1haWxDb25maWcsIEV4dGVuc2lvbkNvbmZpZywgRmFjdG9yQ29uZmlnLCBNZXNzYWdlQ29uZmlnLCBOdW1iZXJDb25maWcsIE51bWVyaWNDb25maWcsIFBhc3N3b3JkQ29uZmlnLCBSYW5nZUNvbmZpZywgUmVxdWlyZWRDb25maWcsIFJ1bGVDb25maWcsIFNpemVDb25maWcsIFRpbWVDb25maWcsIERpZmZlcmVudENvbmZpZywgUmVsYXRpb25hbE9wZXJhdG9yQ29uZmlnLCBVbmlxdWVDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbHMvY29uZmlnJ1xyXG5pbXBvcnQgeyBSZWdleFZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3V0aWwnO1xyXG5pbXBvcnQgeyBSeEZvcm1Db250cm9sIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2Zvcm0tY29udHJvbFwiO1xyXG5pbXBvcnQgeyBNYXNrUHJvdmlkZXIgfSBmcm9tICcuLi8uLi9kb21haW4vZWxlbWVudC1wcm9jZXNzb3IvbWFzay5wcm92aWRlcic7XHJcblxyXG5cclxuY29uc3QgTkdNT0RFTF9CSU5ESU5HOiBhbnkgPSB7XHJcbiAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUnhGb3JtQ29udHJvbERpcmVjdGl2ZSksXHJcbiAgICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuY29uc3QgQUxMT1dfVkFMSURBVE9SX1dJVEhPVVRfQ09ORklHID0gWydyZXF1aXJlZCcsICdub3RFbXB0eScsICdhbHBoYScsICdhbHBoYU51bWVyaWMnLCAnYXNjaWknLCAnZGF0YVVyaScsICdkaWdpdCcsICdlbWFpbCcsICdldmVuJywgJ2hleENvbG9yJywgJ2pzb24nLCAnbGF0aXR1ZGUnLCAnbGF0TG9uZycsICdsZWFwWWVhcicsICdsb25naXR1ZGUnLCAnbG93ZXJDYXNlJywgJ21hYycsICdvZGQnLCAncG9ydCcsICdwcmltZU51bWJlcicsICd0aW1lJywgJ3VwcGVyQ2FzZScsICd1cmwnLCAndW5pcXVlJywnY3VzaXAnLCdnaXJkJ107XHJcbmNvbnN0IE5VTUVSSUM6c3RyaW5nID0gXCJudW1lcmljXCI7XHJcbmNvbnN0IElTX0ZPUk1BVDpzdHJpbmcgPSBcImlzRm9ybWF0XCI7XHJcbmNvbnN0IERJR0lUU19JTkZPOiBzdHJpbmcgPSBcImRpZ2l0c0luZm9cIjtcclxuQERpcmVjdGl2ZSh7XHJcbiAgICBzZWxlY3RvcjogJ1tuZ01vZGVsXSxbZm9ybUNvbnRyb2xOYW1lXSxbZm9ybUNvbnRyb2xdJyxcclxuICAgIHByb3ZpZGVyczogW05HTU9ERUxfQklORElOR10sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSeEZvcm1Db250cm9sRGlyZWN0aXZlIGV4dGVuZHMgQmFzZVZhbGlkYXRvciBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBWYWxpZGF0b3Ige1xyXG4gICAgcHJpdmF0ZSBldmVudExpc3RlbmVyczogYW55W10gPSBbXTtcclxuICAgIHByaXZhdGUgaXNOdW1lcmljU3Vic2NyaWJlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBpc0ZvY3VzQ2FsbGVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGlzTWFza2VkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgXHJcbiAgICBzZXQgdmFsaWRhdGlvbkNvbnRyb2xzKHZhbHVlOiB7IFtrZXk6IHN0cmluZ106IEZvcm1Db250cm9sIH0pIHtcclxuICAgICAgICB0aGlzLmNvbnRyb2xzID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZhbGlkYXRpb25Db250cm9scygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9scztcclxuICAgIH1cclxuXHJcbiAgICBASW5wdXQoKSBhbHBoYTogQWxwaGFDb25maWc7XHJcbiAgICBASW5wdXQoKSBhbHBoYU51bWVyaWM6IEFscGhhQ29uZmlnO1xyXG4gICAgQElucHV0KCkgYXNjaWk6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSBjb21wYXJlOiBDb21wYXJlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgY29tcG9zZTogQ29tcG9zZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGNvbnRhaW5zOiBDb250YWluc0NvbmZpZztcclxuICAgIEBJbnB1dCgpIGNyZWRpdENhcmQ6IENyZWRpdENhcmRDb25maWc7XHJcbiAgICBASW5wdXQoKSBkYXRhVXJpOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgZGlmZmVyZW50OiBEaWZmZXJlbnRDb25maWc7XHJcbiAgICBASW5wdXQoKSBkaWdpdDogRGlnaXRDb25maWc7XHJcbiAgICBASW5wdXQoKSBlbWFpbDogRW1haWxDb25maWc7XHJcbiAgICBASW5wdXQoKSBlbmRzV2l0aDogRGVmYXVsdENvbmZpZztcclxuICAgIEBJbnB1dCgpIGV2ZW46IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSBleHRlbnNpb246IEV4dGVuc2lvbkNvbmZpZztcclxuICAgIEBJbnB1dCgpIGZhY3RvcjogRmFjdG9yQ29uZmlnO1xyXG4gICAgQElucHV0KCkgZmlsZVNpemU6IFNpemVDb25maWc7XHJcbiAgICBASW5wdXQoKSBncmVhdGVyVGhhbkVxdWFsVG86IFJlbGF0aW9uYWxPcGVyYXRvckNvbmZpZztcclxuICAgIEBJbnB1dCgpIGdyZWF0ZXJUaGFuOiBSZWxhdGlvbmFsT3BlcmF0b3JDb25maWc7XHJcbiAgICBASW5wdXQoKSBoZXhDb2xvcjogTWVzc2FnZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGpzb246IERlZmF1bHRDb25maWc7XHJcbiAgICBASW5wdXQoKSBsYXRpdHVkZTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGxhdExvbmc6IEJhc2VDb25maWc7XHJcbiAgICBASW5wdXQoKSBsZWFwWWVhcjogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGxlc3NUaGFuOiBSZWxhdGlvbmFsT3BlcmF0b3JDb25maWc7XHJcbiAgICBASW5wdXQoKSBsZXNzVGhhbkVxdWFsVG86IFJlbGF0aW9uYWxPcGVyYXRvckNvbmZpZztcclxuICAgIEBJbnB1dCgpIGxvbmdpdHVkZTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGxvd2VyQ2FzZTogTWVzc2FnZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIG1hYzogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIG1heERhdGU6IERhdGVDb25maWc7XHJcbiAgICBASW5wdXQoKSBtYXhMZW5ndGg6IE51bWJlckNvbmZpZztcclxuICAgIEBJbnB1dCgpIG1heE51bWJlcjogTnVtYmVyQ29uZmlnO1xyXG4gICAgQElucHV0KCkgbWluRGF0ZTogRGF0ZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIG1pbkxlbmd0aDogTnVtYmVyQ29uZmlnO1xyXG4gICAgQElucHV0KCkgbWluTnVtYmVyOiBOdW1iZXJDb25maWc7XHJcbiAgICBASW5wdXQoKSBudW1lcmljOiBOdW1lcmljQ29uZmlnO1xyXG4gICAgQElucHV0KCkgb2RkOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcGFzc3dvcmQ6IFBhc3N3b3JkQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcG9ydDogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHByaW1lTnVtYmVyOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcmVxdWlyZWQ6IFJlcXVpcmVkQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcmFuZ2U6IFJhbmdlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgcnVsZTogUnVsZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIHN0YXJ0c1dpdGg6IERlZmF1bHRDb25maWc7XHJcbiAgICBASW5wdXQoKSB0aW1lOiBUaW1lQ29uZmlnO1xyXG4gICAgQElucHV0KCkgdXBwZXJDYXNlOiBNZXNzYWdlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgdXJsOiBEZWZhdWx0Q29uZmlnO1xyXG4gICAgQElucHV0KCkgdW5pcXVlOiBVbmlxdWVDb25maWc7XHJcbiAgICBASW5wdXQoKSBub3RFbXB0eTogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGN1c2lwOiBCYXNlQ29uZmlnO1xyXG4gICAgQElucHV0KCkgZ3JpZDogQmFzZUNvbmZpZztcclxuICAgIEBJbnB1dCgpIGRhdGU6QmFzZUNvbmZpZztcclxuXHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZGVjaW1hbFByb3ZpZGVyOiBEZWNpbWFsUHJvdmlkZXIpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBOb2RlO1xyXG4gICAgICAgIHRoaXMuc2V0RXZlbnROYW1lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgbGV0IHZhbGlkYXRvcnMgPSBbXTtcclxuICAgICAgICBPYmplY3Qua2V5cyhBUFBfVkFMSURBVE9SUykuZm9yRWFjaCh2YWxpZGF0b3JOYW1lID0+IHtcclxuICAgICAgICAgICAgaWYgKCh0aGlzW3ZhbGlkYXRvck5hbWVdKSB8fCAoQUxMT1dfVkFMSURBVE9SX1dJVEhPVVRfQ09ORklHLmluZGV4T2YodmFsaWRhdG9yTmFtZSkgIT0gLTEgJiYgdGhpc1t2YWxpZGF0b3JOYW1lXSA9PSBCTEFOSykpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRvcnMucHVzaChBUFBfVkFMSURBVE9SU1t2YWxpZGF0b3JOYW1lXSh0aGlzW3ZhbGlkYXRvck5hbWVdKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lICYmICEodGhpcy5mb3JtQ29udHJvbE5hbWUgJiYgdGhpcy5mb3JtQ29udHJvbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBBcHBsaWNhdGlvblV0aWwuY29uZmlndXJlQ29udHJvbCh0aGlzLmNvbnRyb2xDb25maWcsIHRoaXNbdmFsaWRhdG9yTmFtZV0sIHZhbGlkYXRvck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgaWYgKHZhbGlkYXRvcnMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgdGhpcy52YWxpZGF0b3JzID0gdmFsaWRhdG9yc1xyXG4gICAgICAgIGlmICh0aGlzLm51bWVyaWMgJiYgKHRoaXMubnVtZXJpYy5pc0Zvcm1hdCB8fCB0aGlzLm51bWVyaWMuZGlnaXRzSW5mbykpIHtcclxuICAgICAgICAgICAgdGhpcy5iaW5kTnVtZXJpY0VsZW1lbnRFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcblxyXG4gICAgYmx1ckV2ZW50KCl7XHJcbiAgICAgICAgaWYgKCEodGhpcy5mb3JtQ29udHJvbCAmJiB0aGlzLmZvcm1Db250cm9sLmVycm9ycyAmJiB0aGlzLmZvcm1Db250cm9sLmVycm9ycy5udW1lcmljKSkge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRlY2ltYWxQcm92aWRlci50cmFuc0Zvcm1EZWNpbWFsKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUsIHRoaXMubnVtZXJpYy5kaWdpdHNJbmZvKTtcclxuICAgICAgICAgICAgdmFsdWUgPSAoIXRoaXMubnVtZXJpYy5pc0Zvcm1hdCkgPyB0aGlzLmRlY2ltYWxQcm92aWRlci5yZXBsYWNlcih2YWx1ZSkgOiB2YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNGb2N1c0NhbGxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBiaW5kTnVtZXJpY0VsZW1lbnRFdmVudChjb25maWc/OiBOdW1lcmljQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKGNvbmZpZylcclxuICAgICAgICAgICAgdGhpcy5udW1lcmljID0gY29uZmlnO1xyXG4gICAgICAgIGxldCBsaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudCwgQkxVUiwgdGhpcy5ibHVyRXZlbnQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKVxyXG4gICAgICAgIGxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50LCBGT0NVUywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNGb2N1c0NhbGxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICghKHRoaXMuZm9ybUNvbnRyb2wgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMgJiYgdGhpcy5mb3JtQ29udHJvbC5lcnJvcnMubnVtZXJpYykgJiYgdGhpcy5mb3JtQ29udHJvbC52YWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRlY2ltYWxQcm92aWRlci5yZXBsYWNlcih0aGlzLmVsZW1lbnQudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpXHJcbiAgICB9XHJcblxyXG4gICAgYmluZFZhbHVlQ2hhbmdlRXZlbnQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnROYW1lICE9IEJMQU5LKSB7XHJcbiAgICAgICAgICAgIGxldCBsaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudCwgdGhpcy5ldmVudE5hbWUsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMudmFsaWRhdGlvbkNvbnRyb2xzKS5mb3JFYWNoKGZpZWxkTmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWxpZGF0aW9uQ29udHJvbHNbZmllbGROYW1lXS51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlTnVtZXJpY0Zvcm1hdHRlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiB0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdICYmICh0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdW0lTX0ZPUk1BVF0gfHwgdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtOVU1FUklDXVtESUdJVFNfSU5GT10pKSB7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmlzTnVtZXJpY1N1YnNjcmliZWQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kTnVtZXJpY0VsZW1lbnRFdmVudCh0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW05VTUVSSUNdKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOdW1lcmljU3Vic2NyaWJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIXRoaXMuaXNGb2N1c0NhbGxlZCAmJiBSZWdleFZhbGlkYXRvci5pc05vdEJsYW5rKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUpKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmx1ckV2ZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlTWFza1ZhbGlkYXRvcigpIHtcclxuICAgICAgICBpZiAodGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiB0aGlzLmZvcm1Db250cm9sW1ZBTElEQVRPUl9DT05GSUddW1wibWFza1wiXSAmJiAhdGhpcy5pc01hc2tlZCkge1xyXG4gICAgICAgICAgICBsZXQgY29uZmlnID0gdGhpcy5mb3JtQ29udHJvbFtWQUxJREFUT1JfQ09ORklHXVtcIm1hc2tcIl07XHJcbiAgICAgICAgICAgIHRoaXMubWFza1Byb3ZpZGVyID0gbmV3IE1hc2tQcm92aWRlcih0aGlzLmVsZW1lbnQsIGNvbmZpZy5tYXNrLCB0aGlzLnJlbmRlcmVyLCB0aGlzLmZvcm1Db250cm9sIGFzIEZvcm1Db250cm9sLCBjb25maWcpO1xyXG4gICAgICAgICAgICB0aGlzLmlzTWFza2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRWYWx1ZU9uRWxlbWVudCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsZW1lbnQsIEVMRU1FTlRfVkFMVUUsIHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFRlbXBsYXRlVmFsaWRhdG9ycyhjb250cm9sOkFic3RyYWN0Q29udHJvbCl7XHJcbiAgICAgICAgZm9yKGxldCB2YWxpZGF0b3JOYW1lIGluIGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR10pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzW3ZhbGlkYXRvck5hbWVdID0gY29udHJvbFtWQUxJREFUT1JfQ09ORklHXVt2YWxpZGF0b3JOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVsZXRlIGNvbnRyb2xbVEVNUExBVEVfVkFMSURBVElPTl9DT05GSUddO1xyXG4gICAgICAgIGRlbGV0ZSBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddXHJcbiAgICAgICAgdGhpcy5uZ09uSW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlT25FbGVtZW50Q2xhc3MoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgcHJldmlvdXNDbGFzc05hbWU6IHN0cmluZyA9ICcnO1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2xhc3NOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYgKHByZXZpb3VzQ2xhc3NOYW1lKVxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHByZXZpb3VzQ2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSlcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpXHJcbiAgICAgICAgICAgIHByZXZpb3VzQ2xhc3NOYW1lID0gY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcHJpdmF0ZSBzZXRWYWxpZGF0b3JDb25maWcoY29udHJvbDpBYnN0cmFjdENvbnRyb2wpe1xyXG4gICAgICAgIGlmICghdGhpcy5mb3JtQ29udHJvbCkgeyBcclxuICAgICAgICAgICAgdGhpcy5mb3JtQ29udHJvbCA9IGNvbnRyb2w7XHJcbiAgICAgICAgICAgIGxldCByeEZvcm1Db250cm9sID0gdGhpcy5mb3JtQ29udHJvbCBhcyBSeEZvcm1Db250cm9sO1xyXG4gICAgICAgICAgICBpZiAocnhGb3JtQ29udHJvbC51cGRhdGVPbkVsZW1lbnRDbGFzcylcclxuICAgICAgICAgICAgICAgIHJ4Rm9ybUNvbnRyb2wudXBkYXRlT25FbGVtZW50Q2xhc3MgPSB0aGlzLnVwZGF0ZU9uRWxlbWVudENsYXNzKHRoaXMuZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTWFza1ZhbGlkYXRvcigpO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTnVtZXJpY0Zvcm1hdHRlcigpO1xyXG4gICAgaWYoY29udHJvbFtURU1QTEFURV9WQUxJREFUSU9OX0NPTkZJR10pXHJcbiAgICAgICAgdGhpcy5zZXRUZW1wbGF0ZVZhbGlkYXRvcnMoY29udHJvbCk7XHJcbiAgICBpZiAoY29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvciA9IGNvbnRyb2xbQ09ORElUSU9OQUxfVkFMSURBVE9SXTtcclxuICAgICAgICBkZWxldGUgY29udHJvbFtDT05ESVRJT05BTF9WQUxJREFUT1JdO1xyXG4gICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcclxuICAgICAgICB0aGlzLnNldFZhbGlkYXRvckNvbmZpZyhjb250cm9sKTtcclxuICAgICAgICBpZiAodGhpcy5jb25kaXRpb25hbFZhbGlkYXRvcilcclxuICAgICAgICAgICAgdGhpcy5jb25kaXRpb25hbFZhbGlkYXRvcihjb250cm9sKTtcclxuICAgICAgICBpZiAoIXRoaXMuaXNQcm9jZXNzZWQpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0TW9kZWxDb25maWcoY29udHJvbCk7XHJcbiAgICAgICAgcmV0dXJuICgodGhpcy52YWxpZGF0b3JzICYmIHRoaXMudmFsaWRhdG9ycy5sZW5ndGggPiAwKSB8fCB0aGlzLm1hc2tQcm92aWRlcikgPyB0aGlzLnZhbGlkYXRpb24oY29udHJvbCkgOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMuY29udHJvbHMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgbGV0IGV2ZW50Q291bnQgPSB0aGlzLmV2ZW50TGlzdGVuZXJzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzWzBdKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKDAsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMubWFza1Byb3ZpZGVyKVxyXG4gICAgICAgICAgICB0aGlzLm1hc2tQcm92aWRlci5vbkRlc3Ryb3koKTtcclxuICAgIH1cclxufVxyXG4iXX0=