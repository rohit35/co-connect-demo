import * as tslib_1 from "tslib";
import { Input, Directive, forwardRef, ElementRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { APP_VALIDATORS } from "../../const/app-validators.const";
var VALIDATOR_CONFIG = "validatorConfig";
var FILE_VALIDATOR_NAMES = ["extension", "fileSize", "file"];
var FileControlDirective = /** @class */ (function () {
    function FileControlDirective(elementRef) {
        this.elementRef = elementRef;
        this.isProcessed = false;
        this.validators = [];
        this.onChange = function (_) { };
        this.onTouched = function () { };
        this.element = elementRef.nativeElement;
    }
    FileControlDirective_1 = FileControlDirective;
    FileControlDirective.prototype.onChangeCall = function (element) {
        var files = element.files;
        if (this.writeFile)
            this.onChange(files);
        else {
            if (files.length > 0)
                this.onChange(element.value);
            else
                this.onChange(undefined);
        }
    };
    FileControlDirective.prototype.writeValue = function (value) { };
    FileControlDirective.prototype.registerOnChange = function (invocation) { this.onChange = invocation; };
    FileControlDirective.prototype.registerOnTouched = function (invocation) { this.onTouched = invocation; };
    Object.defineProperty(FileControlDirective.prototype, "extension", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[0], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "fileSize", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[1], config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FileControlDirective.prototype, "file", {
        set: function (config) {
            this.pushValidator(FILE_VALIDATOR_NAMES[2], config);
        },
        enumerable: true,
        configurable: true
    });
    FileControlDirective.prototype.setConfig = function (control) {
        var _this = this;
        FILE_VALIDATOR_NAMES.forEach(function (t) {
            if (!_this[t] && control[VALIDATOR_CONFIG] && control[VALIDATOR_CONFIG][t])
                _this[t] = control[VALIDATOR_CONFIG][t];
        });
        this.isProcessed = true;
    };
    FileControlDirective.prototype.pushValidator = function (validatorName, config) {
        if (config)
            this.validators.push(APP_VALIDATORS[validatorName](config));
    };
    FileControlDirective.prototype.validate = function (control) {
        var e_1, _a;
        if (!this.isProcessed)
            this.setConfig(control);
        var result = null;
        try {
            for (var _b = tslib_1.__values(this.validators), _c = _b.next(); !_c.done; _c = _b.next()) {
                var validator = _c.value;
                result = validator(control, this.element.files);
                if (result)
                    break;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return result;
    };
    var FileControlDirective_1;
    FileControlDirective.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    tslib_1.__decorate([
        Input()
    ], FileControlDirective.prototype, "writeFile", void 0);
    tslib_1.__decorate([
        Input()
    ], FileControlDirective.prototype, "extension", null);
    tslib_1.__decorate([
        Input()
    ], FileControlDirective.prototype, "fileSize", null);
    tslib_1.__decorate([
        Input()
    ], FileControlDirective.prototype, "file", null);
    FileControlDirective = FileControlDirective_1 = tslib_1.__decorate([
        Directive({
            selector: "input[type=file]",
            host: {
                "(change)": "onChangeCall($event.target)",
                "(blur)": "onTouched()"
            },
            providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: FileControlDirective_1, multi: true }, {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return FileControlDirective_1; }),
                    multi: true
                }]
        })
    ], FileControlDirective);
    return FileControlDirective;
}());
export { FileControlDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1jb250cm9sLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvIiwic291cmNlcyI6WyJkaXJlY3RpdmVzL3RlbXBsYXRlLXZhbGlkYXRpb25zL2ZpbGUtY29udHJvbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekUsT0FBTyxFQUFtQixhQUFhLEVBQWEsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5RixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEUsSUFBTSxnQkFBZ0IsR0FBRyxpQkFBaUIsQ0FBQztBQUMzQyxJQUFNLG9CQUFvQixHQUFhLENBQUMsV0FBVyxFQUFFLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztBQWF6RTtJQXVDSSw4QkFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQXBDMUMsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFHckIsZUFBVSxHQUFlLEVBQUUsQ0FBQztRQUVwQyxhQUFRLEdBQUcsVUFBQyxDQUFDLElBQU8sQ0FBQyxDQUFDO1FBQ3RCLGNBQVMsR0FBRyxjQUFRLENBQUMsQ0FBQztRQStCbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUMsYUFBcUIsQ0FBQztJQUNwRCxDQUFDOzZCQXpDUSxvQkFBb0I7SUFXN0IsMkNBQVksR0FBWixVQUFhLE9BQXlCO1FBQ2xDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDMUIsSUFBSSxJQUFJLENBQUMsU0FBUztZQUNkLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDcEI7WUFDRCxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQztnQkFDaEIsSUFB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QUFFO29CQUN4RixPQUFPLEVBQUUsYUFBYTtvQkFDdEIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEsc0JBQW9CLEVBQXBCLENBQW9CLENBQUM7b0JBQ25ELEtBQUssRUFBRSxJQUFJO2lCQUNkLENBQUM7U0FDTCxDQUFDO09BQ1csb0JBQW9CLENBbUVoQztJQUFELDJCQUFDO0NBQUEsQUFuRUQsSUFtRUM7U0FuRVksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQsIERpcmVjdGl2ZSwgZm9yd2FyZFJlZiwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIE5HX1ZBTElEQVRPUlMsIFZhbGlkYXRvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEV4dGVuc2lvbkNvbmZpZywgU2l6ZUNvbmZpZywgRmlsZUNvbmZpZyB9IGZyb20gJy4uLy4uL21vZGVscy9jb25maWcnXHJcbmltcG9ydCB7IEFQUF9WQUxJREFUT1JTIH0gZnJvbSBcIi4uLy4uL2NvbnN0L2FwcC12YWxpZGF0b3JzLmNvbnN0XCI7XHJcbmNvbnN0IFZBTElEQVRPUl9DT05GSUcgPSBcInZhbGlkYXRvckNvbmZpZ1wiO1xyXG5jb25zdCBGSUxFX1ZBTElEQVRPUl9OQU1FUzogc3RyaW5nW10gPSBbXCJleHRlbnNpb25cIiwgXCJmaWxlU2l6ZVwiLCBcImZpbGVcIl07XHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6IFwiaW5wdXRbdHlwZT1maWxlXVwiLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgIFwiKGNoYW5nZSlcIjogXCJvbkNoYW5nZUNhbGwoJGV2ZW50LnRhcmdldClcIixcclxuICAgICAgICBcIihibHVyKVwiOiBcIm9uVG91Y2hlZCgpXCJcclxuICAgIH0sXHJcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLCB1c2VFeGlzdGluZzogRmlsZUNvbnRyb2xEaXJlY3RpdmUsIG11bHRpOiB0cnVlIH0sIHtcclxuICAgICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEZpbGVDb250cm9sRGlyZWN0aXZlKSxcclxuICAgICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgfV1cclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbGVDb250cm9sRGlyZWN0aXZlIGltcGxlbWVudHMgVmFsaWRhdG9yIHtcclxuICAgIGZpbGVzOiBhbnk7XHJcbiAgICBlbGVtZW50OiBhbnlcclxuICAgIGlzUHJvY2Vzc2VkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBcclxuXHJcbiAgICBwcml2YXRlIHZhbGlkYXRvcnM6IEZ1bmN0aW9uW10gPSBbXTtcclxuXHJcbiAgICBvbkNoYW5nZSA9IChfKSA9PiB7IH07XHJcbiAgICBvblRvdWNoZWQgPSAoKSA9PiB7IH07XHJcblxyXG4gICAgb25DaGFuZ2VDYWxsKGVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgZmlsZXMgPSBlbGVtZW50LmZpbGVzO1xyXG4gICAgICAgIGlmICh0aGlzLndyaXRlRmlsZSlcclxuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShmaWxlcyk7XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShlbGVtZW50LnZhbHVlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSh1bmRlZmluZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB3cml0ZVZhbHVlKHZhbHVlKSB7IH1cclxuICAgIHJlZ2lzdGVyT25DaGFuZ2UoaW52b2NhdGlvbjogYW55KSB7IHRoaXMub25DaGFuZ2UgPSBpbnZvY2F0aW9uOyB9XHJcbiAgICByZWdpc3Rlck9uVG91Y2hlZChpbnZvY2F0aW9uOiBhbnkpIHsgdGhpcy5vblRvdWNoZWQgPSBpbnZvY2F0aW9uOyB9XHJcblxyXG4gICAgQElucHV0KCkgd3JpdGVGaWxlOiBib29sZWFuO1xyXG4gICAgQElucHV0KCkgc2V0IGV4dGVuc2lvbihjb25maWc6IEV4dGVuc2lvbkNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1swXSwgY29uZmlnKVxyXG4gICAgfVxyXG4gICAgQElucHV0KCkgc2V0IGZpbGVTaXplKGNvbmZpZzogU2l6ZUNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1sxXSwgY29uZmlnKVxyXG4gICAgfVxyXG5cclxuICAgIEBJbnB1dCgpIHNldCBmaWxlKGNvbmZpZzogRmlsZUNvbmZpZykge1xyXG4gICAgICAgIHRoaXMucHVzaFZhbGlkYXRvcihGSUxFX1ZBTElEQVRPUl9OQU1FU1syXSwgY29uZmlnKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBOb2RlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldENvbmZpZyhjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpIHtcclxuICAgICAgICBGSUxFX1ZBTElEQVRPUl9OQU1FUy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXNbdF0gJiYgY29udHJvbFtWQUxJREFUT1JfQ09ORklHXSAmJiBjb250cm9sW1ZBTElEQVRPUl9DT05GSUddW3RdKVxyXG4gICAgICAgICAgICAgICAgdGhpc1t0XSA9IGNvbnRyb2xbVkFMSURBVE9SX0NPTkZJR11bdF07XHJcbiAgICAgICAgfSlcclxuICAgICAgICB0aGlzLmlzUHJvY2Vzc2VkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdXNoVmFsaWRhdG9yKHZhbGlkYXRvck5hbWU6IHN0cmluZywgY29uZmlnOiBFeHRlbnNpb25Db25maWcgfCBTaXplQ29uZmlnIHwgRmlsZUNvbmZpZykge1xyXG4gICAgICAgIGlmIChjb25maWcpXHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdG9ycy5wdXNoKEFQUF9WQUxJREFUT1JTW3ZhbGlkYXRvck5hbWVdKGNvbmZpZykpXHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUHJvY2Vzc2VkKVxyXG4gICAgICAgICAgICB0aGlzLnNldENvbmZpZyhjb250cm9sKTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICBmb3IgKHZhciB2YWxpZGF0b3Igb2YgdGhpcy52YWxpZGF0b3JzKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHZhbGlkYXRvcihjb250cm9sLCB0aGlzLmVsZW1lbnQuZmlsZXMpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRcclxuICAgIH1cclxufVxyXG4iXX0=